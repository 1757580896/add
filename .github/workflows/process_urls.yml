name: URL Processing

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'

jobs:
  process-urls:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: pip install requests==2.31.0

    - name: Run processor with debug
      run: |
        # 打印当前目录结构
        echo "=== Initial files ==="
        ls -lh
        
        # 执行脚本并显示详细输出
        python url_processor.py
        
        # 检查生成的文件
        echo -e "\n=== Generated files ==="
        ls -lh processed_*.txt combined_results.txt 2>/dev/null || echo "No output files found"
        
        # 如果文件存在则显示部分内容
        if [ -f processed_url1.txt ]; then
          echo -e "\n=== Sample content ==="
          head -n 3 processed_*.txt
        fi

    - name: Upload artifacts
      if: success() && exists('processed_url1.txt')
      uses: actions/upload-artifact@v4
      with:
        name: url-results
        path: |
          processed_url*.txt
          combined_results.txt
        retention-days: 3

    - name: Fail if no output
      if: success() && !exists('processed_url1.txt')
      run: |
        echo "::error::No output files were generated!"
        exit 1
